{
	"name": "11_0_PolybaseExternalObjectsDim",
	"properties": {
		"content": {
			"query": "/* \n--Created before\nCREATE MASTER KEY;\n\n--Credential used to authenticate to External Data Source \nCREATE DATABASE SCOPED CREDENTIAL AzureStorageCredential\nWITH\n    IDENTITY = 'user',\n    SECRET = 'Fdnk0yeqCyV4DvzMJ0yGWGmLn33ooJ0hqCJDE9L7iVBRjaLp8JAJT9avwaLciBelxIsFwG5Z9OKqWxsAOfGF2g=='\n;\n\n--Describes where the data is located at a coarse grain\n--This will be on the nycstaging container that were created in Module 1's lab where the datasets are uploaded to Data Lake folders\nCREATE EXTERNAL DATA SOURCE NYTBlob\nWITH\n(\n    TYPE = Hadoop,\n    LOCATION = 'wasbs://blobroot@asadatalakemarysynapse.blob.core.windows.net/',\n\tCREDENTIAL = AzureStorageCredential\n);\n*/\n--File formats describes how the files are written\n--We will load one file which is a fact table. This will be an uncompressed file. \nCREATE EXTERNAL FILE FORMAT csvfact\nWITH (\n    FORMAT_TYPE = DELIMITEDTEXT,\n    FORMAT_OPTIONS ( \n\tFIELD_TERMINATOR = ',',\n        STRING_DELIMITER = '',\n        USE_TYPE_DEFAULT = False,\t\t\n\t\tFIRST_ROW = 3\n    )\n);\n\n--Dimension tables are in csv file having a pipe (|) character as delimiter.\nCREATE EXTERNAL FILE FORMAT csvdimension\nWITH (\n    FORMAT_TYPE = DELIMITEDTEXT,\n    FORMAT_OPTIONS ( \n\tFIELD_TERMINATOR = '|',\n        STRING_DELIMITER = '',\n        USE_TYPE_DEFAULT = False,\t\t\n\t\tFIRST_ROW = 2\n    )\n);\n\n\n--Create a schema for the staging/external tables\nCREATE SCHEMA [NYTaxiSTG];\n\n\n--External table creates a reference to the file in the blob storage, the table is not created in Synapse SQL Pool physically\n--The below external table will references only one .csv file as this will be loaded incrementally for December 2018 only.\nCREATE EXTERNAL TABLE [NYTaxiSTG].[Trips]\n(\n    [VendorID] varchar(10) NOT NULL,\n    [tpep_pickup_datetime] datetime NOT NULL,\n    [tpep_dropoff_datetime] datetime NOT NULL,\n    [passenger_count] int NOT NULL,\n    [trip_distance] float NOT NULL,\n    [RateCodeID] int NULL,\n    [store_and_fwd_flag] varchar(3) NULL,\n    [PULocationID] int NULL,\n    [DOLocationID] int NULL,\n    [payment_type] int NULL,\n    [fare_amount] money NULL,\n    [extra] money NULL,\n    [mta_tax] money NULL,\n    [tip_amount] money NULL,\n    [tolls_amount] money NULL,\n    [improvement_surcharge] money NULL,\n    [total_amount] money NULL\n)\nWITH\n(\n    LOCATION = 'nyctaxistaging/Fact/yellow_tripdata_2018-12.csv',\n    DATA_SOURCE = NYTBlob,\n    FILE_FORMAT = csvfact,\n    REJECT_TYPE = value,\n    REJECT_VALUE = 0\n);\n\n\n--The following statements creates external table reference to the csv files in Azure Data Lake for all the dimension tables\n\n-- NOTE: paths are case sensetive\n\nCREATE EXTERNAL TABLE [NYTaxiSTG].[StoreFwdFlag]\n(\n    [Flag] varchar(2) NOT NULL,\n    [Description] varchar(40) NOT NULL\n)\nWITH\n(\n    LOCATION = 'nyctaxistaging/Dimension/StoreFwdFlag.csv',\n    DATA_SOURCE = NYTBlob,\n    FILE_FORMAT = csvdimension,\n    REJECT_TYPE = value,\n    REJECT_VALUE = 0\n);\n\n\nCREATE EXTERNAL TABLE [NYTaxiSTG].[Vendor]\n(\n    [VendorID] int NOT NULL,\n    [Description] varchar(40) NOT NULL\n)\nWITH\n(\n    LOCATION = 'nyctaxistaging/Dimension/Vendor.csv',\n    DATA_SOURCE = NYTBlob,\n    FILE_FORMAT = csvdimension,\n    REJECT_TYPE = value,\n    REJECT_VALUE = 0\n);\n\nCREATE EXTERNAL TABLE [NYTaxiSTG].[Date]\n(\n    [Date] date NOT NULL,\n    [DateKey] int NOT NULL,\n\t[Month] varchar(15) NOT NULL,\n\t[Year] int NOT NULL,\n\t[MonthNo] int NOT NULL,\n\t[QuarterNo] int NOT NULL,\n\t[Quarter] varchar(5) NOT NULL,\n\t[MMM-YYYY] varchar(20) NOT NULL,\n\t[DayOfWeekNo] int NOT NULL,\n\t[DayOfWeek] varchar(11) NOT NULL,\n\t[Day] int\n)\nWITH\n(\n    LOCATION = 'nyctaxistaging/Dimension/Date.csv',\n    DATA_SOURCE = NYTBlob,\n    FILE_FORMAT = csvdimension,\n    REJECT_TYPE = value,\n    REJECT_VALUE = 0\n);\n\n\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "wplussynapsedw",
				"poolName": "wplussynapsedw"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}